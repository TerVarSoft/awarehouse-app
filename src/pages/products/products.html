<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start" menuToggle>
      <ion-menu-button autoHide="false"></ion-menu-button>
    </ion-buttons>
    <ion-title>
      Productos Tunari
    </ion-title>
  </ion-toolbar>

  <ion-toolbar color="primary">
    <ion-searchbar animated=true #searchInput placeholder="Que buscas hoy?" [formControl]="searchQuery" (ionClear)="onSearchClear()"></ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-spinner name="dots" *ngIf="productsAreLoading"></ion-spinner>
  <ion-list *ngIf="!productsAreLoading">
    <ion-item-sliding *ngFor="let product of products" (click)="goToProductDetails(product)">
      <ion-item>
        <ion-thumbnail slot="start">
          <product-img [product]="product"></product-img>
        </ion-thumbnail>
        <ion-label>
          <h2 class="text-color">{{product.name}}</h2>
          <h3 class="text-color">{{product.description || product.properties?.type}}</h3>
          <p>
            {{getSelectedProductPrice(product)}}
          </p>
        </ion-label>


        <ion-icon item-end (click)="openProductOptions($event, product)" color="primary" name="more"></ion-icon>

      </ion-item>
      <ion-item-options side="start">
        <ion-item-option (click)="addPriceWhenNoPrice($event, product)" color="primary">
          <ion-icon name="pricetag"></ion-icon>
          Precio
        </ion-item-option>
        <!-- <ion-button (click)="addPriceWhenNoPrice($event, product)" color="primary">
          <ion-icon name="pricetag"></ion-icon>
          Precio
        </ion-button> -->
        <ion-item-option (click)="setProductQuantity($event, product)" color="primary">
          <ion-icon name="home"></ion-icon>
          Cantidad
        </ion-item-option>
      </ion-item-options>
      <ion-item-options side="end">
        <ion-item-option (click)="createSelling($event, product)" color="primary">
          <ion-icon name="basket"></ion-icon>
          Vender
        </ion-item-option>
      </ion-item-options>
    </ion-item-sliding>
  </ion-list>

  <ion-fab vertical="bottom" horizontal="end" #fab slot="fixed" (click)="createProduct(fab)">
    <ion-fab-button color="secondary">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-infinite-scroll (ionInfinite)="pullNextProductsPage($event)">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Cargando mas productos">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>


<ion-footer>
  <ion-toolbar>
    <ion-chip *ngIf="productCategories && productCategories.length > 2" (click)="changeCategory($event)">
      <ion-label>{{selectedCategory.name}}</ion-label>
    </ion-chip>
    <ion-chip *ngIf="productTypes && productTypes.length > 2" (click)="changeType($event)">
      <ion-label>{{selectedType.name}}</ion-label>
    </ion-chip>
    <ion-chip *ngIf="productPrices && productPrices.length > 0" (click)="changePrice($event)">
      <ion-label>{{selectedPrice.name}}</ion-label>
    </ion-chip>
  </ion-toolbar>
</ion-footer>